<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui" xmlns:b="http://bootsfaces.net/ui">

<ui:composition template="WEB-INF/template/userTemplate.xhtml">

	<ui:define name="head">
		<title>Mes prestations</title>
		<link rel="icon" href="resources/img/favicon.ico" />
	</ui:define>

	<ui:define name="content">

		<div class="title-page">
			<div class="section-title">
				<h2>Prestation</h2>
				<p>Ma prestation : #{mbService.service.invoiceNumber}</p>
			</div>
		</div>

		<main class="mt-5 pt-4">

		<div style="margin: 0 auto">
			<div class="container wow fadeIn">

				<!-- Heading -->

				<!--Grid row-->
				<div class="row">

					<!--Grid column-->

					<div style="display: flex;">
						>
						<div class="col-md-8 mb-4">

							<!--Card-->
							<div class="card">

								<div class="row">
									<div class="category-description">
										<h2>Infos principal</h2>
									</div>
								</div>



								<div class="icon-info-presta">
									<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
									<div class="icon-info-descr">
										<h4>Vous êtes : #{mbService.service.field.owner eq
											mbUser.user ? "Proprietaire de terrain" : "Prestataire"}</h4>
									</div>
								</div>

								<div class="icon-info-presta">
									<br />
									<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
									<div class="icon-info-descr">
										<h4>Statut : #{mbService.serviceState()}</h4>
									</div>
								</div>

								<div class="icon-info-presta">
									<br />
									<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
									<div class="icon-info-descr">
										<h4>Terrain: #{mbService.service.field.name}</h4>
									</div>
								</div>

								<div class="icon-info-presta">
									<br />
									<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
									<div class="icon-info-descr">
										<h4>Longueur d'herbe:
											#{mbService.service.grassHeight.height}</h4>
									</div>
								</div>


								<div class="icon-info-presta">
									<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
									<div class="icon-info-descr">
										<h4>Offre concernée :
											#{mbService.service.shearingOffer.name}</h4>
									</div>
								</div>

								<div class="icon-info-presta">
									<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
									<div class="icon-info-descr">
										<h4>Durée :
											#{mbService.calculateServiceNumberOfDaysByService()} jours</h4>
									</div>
								</div>

								<div class="row">
									<div class="box-calendar">
										<div class="calendar-offer">
											<label>Date de début</label>
											<p:calendar id="inline"
												value="#{mbService.service.startDate}" mode="inline"
												disabled="true" />
										</div>
										<div class="calendar-offer">
											<label>Date de fin</label>
											<p:calendar id="inline2" value="#{mbService.service.endDate}"
												mode="inline" disabled="true" />
										</div>
									</div>
								</div>


								<hr />
								<div class="row">
									<div class="category-description">
										<h2>Concernant l'offre</h2>
									</div>
								</div>

								<div class="box-group-information">
									<div class="group-info">
										<div class="icon-info-presta">
											<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
											<div class="icon-info-descr">
												<h4>Responsable :
													#{mbService.service.shearingOffer.breeder eq mbUser.user ?
													"Vous" : mbService.service.shearingOffer.breeder.firstName
													}</h4>
											</div>
										</div>

										<div class="icon-info-presta">
											<br />
											<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
											<div class="icon-info-descr">
												<h4>Nombre d'animaux:
													#{mbService.service.requiredAnimalCount}</h4>
											</div>
										</div>
									</div>
									<div class="group-info">
										<div class="icon-info-presta">
											<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
											<div class="icon-info-descr">
												<h4>Espèce :
													#{mbService.service.shearingOffer.race.species.species}</h4>
											</div>
										</div>

										<div class="icon-info-presta">
											<br />
											<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
											<div class="icon-info-descr">
												<h4>Race : #{mbService.service.shearingOffer.race.race}</h4>
											</div>
										</div>
									</div>
								</div>
								<hr class="mb-4" />

								<div class="row">
									<div class="category-description">
										<h2>Concernant le terrain</h2>
									</div>
								</div>

								<div class="box-group-information">
									<div class="group-info">
										<div class="icon-info-presta">
											<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
											<div class="icon-info-descr">
												<h4>Proprietaire : #{mbService.service.field.owner eq
													mbUser.user ? "Vous" :
													mbService.service.field.owner.firstName }</h4>
											</div>
										</div>

										<div class="icon-info-presta">
											<br />
											<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
											<div class="icon-info-descr">
												<h4>Superficie: #{mbService.service.field.area} m²</h4>
											</div>
										</div>
									</div>
									<div class="group-info">
										<div class="icon-info-presta">
											<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
											<div class="icon-info-descr">
												<h4>Ville : #{mbService.service.field.zipCodeCity.name}</h4>
											</div>
										</div>

										<div class="icon-info-presta">
											<br />
											<b:iconAwesome class="icon-info" name="info-circle" size="lg" />
											<div class="icon-info-descr">
												<h4>Adresse : #{mbService.service.field.address}</h4>
											</div>
										</div>
									</div>
								</div>


								<hr />
								<div class="row">
									<div class="category-description">
										<h2>Déroulement</h2>
									</div>
								</div>

								<div class="icon-info-presta">
									<br />
									<b:iconAwesome name="chevron-circle-right" size="lg" />
									<div class="icon-info-descr">
										<h4>Installation du matériel :
											#{mbService.service.equipmentSetupDate eq null ? "À venir" :
											mbDate.localDateTimeFormatterWithHour(mbService.service.equipmentSetupDate)}</h4>
									</div>
								</div>

								<div class="icon-info-presta">
									<br />
									<b:iconAwesome name="chevron-circle-right" size="lg" />
									<div class="icon-info-descr">
										<h4>Installation du troupeau :
											#{mbService.service.herdSetupDate eq null ? "À venir" :
											mbDate.localDateTimeFormatterWithHour(mbService.service.herdSetupDate)}</h4>
									</div>
								</div>

							</div>
							<!--/.Card-->

						</div>
						<!--Grid column-->

						<div class="col-md-6 mb-4">

							<ui:fragment
								rendered="#{mbService.breederServiceManagementSection() eq 'false'}">
								<div class="card">
									<div class="row">
										<div class="category-description">
											<h2>
												Gestions
												<b:iconAwesome name="cog" />
											</h2>
										</div>
									</div>

									<ui:fragment
										rendered="#{mbService.validateRefuseCancelServiceRequestButton() eq 'false'}">
										<div class="btn-breeder">
											<p:commandButton value="Accepter la demande"
												styleClass="rounded-button ui-button-warning"
												style="background-color: #5fcf80; border-color: transparent;"
												action="#{mbService.validateServiceRequest()}"
												id="btnValidateRequest" />
										</div>
										<div class="btn-breeder">
											<button value="Refuser la demande" class="get-started-btn"
												data-target="#refuseModal" data-toggle="modal"
												style="background-color: red;" id="btnRefuseRequest">Refuser
												la demande</button>
										</div>
									</ui:fragment>

									<ui:fragment
										rendered="#{mbService.cancelServicePrematurelyButton() eq 'false'}">
										<div class="btn-breeder">
											<button value="Annuler la prestation" class="get-started-btn"
												data-target="#prematureCancelModal" data-toggle="modal"
												id="btnPrematureCancellation" style="background-color: red;">Annuler
												la prestation</button>
										</div>
									</ui:fragment>

									<ui:fragment
										rendered="#{mbService.equipmentSetupButton() eq 'false'}">
										<div class="btn-breeder">
											<p:commandButton value="Installer le matériel"
												styleClass="rounded-button ui-button-warning"
												action="#{mbService.setupEquipment()}"
												id="btnEquipmentSetup" />
										</div>
									</ui:fragment>

									<ui:fragment
										rendered="#{mbService.equipmentUninstallButton() eq 'false'}">
										<div class="btn-breeder">
											<p:commandButton value="Désinstaller le matériel"
												styleClass="rounded-button ui-button-warning"
												action="#{mbService.uninstallEquipment()}"
												id="btnEquipmentUninstall" />
										</div>
									</ui:fragment>

									<ui:fragment
										rendered="#{mbService.herdSetupButton() eq 'false'}">
										<div class="btn-breeder">
											<p:commandButton value="Installer le troupeau"
												styleClass="rounded-button ui-button-warning"
												action="#{mbService.setupHerd()}" id="btnHerdSetup" />
										</div>
									</ui:fragment>

									<ui:fragment
										rendered="#{mbService.herdUnistallButton() eq 'false'}">
										<div class="btn-breeder">
											<p:commandButton value="Désinstaller le troupeau"
												styleClass="rounded-button ui-button-warning"
												action="#{mbService.uninstallHerd()}" id="btnHerdUninstall" />
										</div>
									</ui:fragment>

								</div>
							</ui:fragment>

							<div class="card" style="border-top: none;">
								<div class="row">
									<div class="category-description">
										<h2>
											Anomalies
											<b:iconAwesome name="bell" />
										</h2>
									</div>
								</div>


								<ui:fragment
									rendered="#{mbService.anomalyCreationButton() eq 'false'}">
									<button value="Nouvelle anomalie" class="get-started-btn"
										data-target="#anomalieModal" data-toggle="modal"
										id="btnAnomaly">Nouvelle anomalie</button>
								</ui:fragment>

								<div class="row">

									<div class="table-box">
										<div class="table-offer">
											<table class="table table-dark table-striped">
												<thead>
													<tr>
														<th scope="col">Numéro</th>
														<th scope="col">Déclarant</th>
														<th scope="col">Date d'émission</th>
														<th scope="col">Type</th>
														<th scope="col">Statut</th>
													</tr>
												</thead>
												<tbody>

													<ui:repeat var="anomaly"
														value="#{mbAnomaly.allAnonomaliesByService(mbService.service)}">

														<tr>
															<th scope="row"><p:commandLink
																	value="#{anomaly.anomalyNumber}" type="button"
																	action="#{mbAnomaly.selectAnomaly(anomaly)}"
																	update="idAnomaly"
																	style="font-size: 12px; color: #5fcf80">

																</p:commandLink></th>
															<td>#{mbDate.localDateTimeFormatterWithHour(anomaly.creationDate)}</td>
															<td>#{anomaly.declarer.firstName}</td>
															<td>#{anomaly.anomalyType.type}</td>
															<ui:fragment rendered="#{anomaly.endDate == null}">
																<td>En cours <b:iconAwesome name="cog" spin="true" /></td>
															</ui:fragment>
															<ui:fragment rendered="#{anomaly.endDate != null}">
																<td>Réglée <b:iconAwesome name="check" /></td>
															</ui:fragment>

														</tr>
													</ui:repeat>
												</tbody>
											</table>
										</div>
									</div>
								</div>


								<ui:fragment
									rendered="#{mbService.serviceRatingSection() eq 'false'}">
									<hr />
									<div class="row">
										<div class="category-description">
											<h2>
												Evaluation
												<b:iconAwesome name="graduation-cap" />
											</h2>
										</div>

										<ui:fragment
											rendered="#{mbRating.ratingFormVisibility(mbService.service) eq 'false'}">

											<b:form>
												<div class="rating-form-box">

													<div class="rating-form">
														<p:rating value="#{mbRating.ratingLevel}" />
													</div>
													<div class="rating-form">
														<p:inputTextarea
															placeholder="Laissez un avis sur le déroulement de la prestation"
															value="#{mbRating.feedback}" maxlength="255" rows="6"
															cols="50">
														</p:inputTextarea>
													</div>
													<div class="rating-form">
														<b:commandButton class="get-started-btn" value="Evaluer"
															action="#{mbRating.rateService(mbService.service)}" />

													</div>
												</div>
											</b:form>

										</ui:fragment>
										<ui:fragment
											rendered="#{mbRating.ratingFormVisibility(mbService.service) eq 'true'}">
											<div class="rating-form-box">
												<ui:repeat var="rating"
													value="#{mbRating.allRatingsByService(mbService.service)}">
													<div class="rating-form">
														<b:label
															value="#{rating.evaluator eq mbUser.user ? 'Votre évaluation :' : 'Évaluation reçu : '}" />
													</div>
													<div class="rating-form">
														<p:rating value="#{rating.ratingLevel}" readonly="true" />
													</div>
													<div class="rating-form">
														<p:inputTextarea
															placeholder="Laissez un avis sur le déroulement de la prestation"
															value="#{rating.feedback}" maxlength="255" rows="6"
															cols="50" disabled="true">
														</p:inputTextarea>
													</div>
												</ui:repeat>
											</div>
										</ui:fragment>
									</div>

								</ui:fragment>


							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<b:modal id="anomalieModal">
			<div class="modal-body">
				<div class="form-title text-center">
					<h3>Déclarer une anomalie</h3>
					<br />
				</div>
				<div class="d-flex flex-column text-center">
					<b:form id="loginForm">
						<div class="form-group">
							<b:selectOneMenu id="inpAnomalyType"
								value="#{mbAnomaly.anomalyType}" required="true"
								converter="entityConverter"
								requiredMessage="Vous devez séléctionner un type">
								<f:selectItem itemLabel="Séléctionnez un type" itemValue="" />
								<f:selectItems value="#{mbAnomalyType.allAnomalyTypes()}"
									var="type" itemLabel="#{type.type}" itemValue="#{type}" />
							</b:selectOneMenu>
						</div>
						<div class="form-group">
							<b:inputTextarea
								placeholder="Décrivez le plus précisement possible votre anomalie"
								value="#{mbAnomaly.description}">

							</b:inputTextarea>
						</div>
						<b:commandButton value="Déclarer" class="get-started-btn"
							style="position: relative; top: 27px;"
							action="#{mbAnomaly.declareAnomaly(mbService.service)}" />
					</b:form>
				</div>
			</div>
			<div class="modal-footer d-flex justify-content-center">
				<div class="signup-section">

					<h4></h4>
				</div>
			</div>

			<f:facet name="footer">
				<b:button id="close" value="Fermer" dismiss="modal" />
			</f:facet>
		</b:modal> <b:modal id="refuseModal">

			<div class="modal-body">
				<div class="form-title text-center">
					<h3>Refuser la demande de tonte</h3>
					<br />
				</div>
				<div class="d-flex flex-column text-center">
					<b:form id="refusalModalForm">
						<div class="form-group">
							<b:selectOneMenu id="inpRefusalReason"
								value="#{mbService.refusalReason}" required="true"
								converter="entityConverter"
								requiredMessage="Vous devez séléctionner la raison">
								<f:selectItem itemLabel="Séléctionnez une raison" itemValue="" />
								<f:selectItems value="#{mbRefusalReason.allRefusalReasons()}"
									var="reason" itemLabel="#{reason.reason}" itemValue="#{reason}" />

							</b:selectOneMenu>
							<b:message id="refusalReasonMessage" for="inpRefusalReason" />
						</div>
						<b:commandButton value="Confirmer" class="get-started-btn"
							style="position: relative; top: 27px;"
							action="#{mbService.refuseServiceRequest()}" />
					</b:form>
				</div>
			</div>
			<div class="modal-footer d-flex justify-content-center">
				<div class="signup-section">

					<h4></h4>
				</div>
			</div>

			<f:facet name="footer">
				<b:button id="closeRefusalModal" value="Fermer" dismiss="modal" />
			</f:facet>
		</b:modal> <b:modal id="prematureCancelModal">

			<div class="modal-body">
				<div class="form-title text-center">
					<h3>Annuler prématurement la demande de tonte</h3>
					<br />
				</div>
				<div class="d-flex flex-column text-center">
					<b:form id="prematureCancellationModalForm">
						<div class="form-group">
							<b:selectOneMenu id="inpPrematureCancellationReason"
								value="#{mbService.prematureCancellationReason}" required="true"
								converter="entityConverter"
								requiredMessage="Vous devez séléctionner la raison">
								<f:selectItem itemLabel="Séléctionnez une raison" itemValue="" />
								<f:selectItems
									value="#{mbPrematureCancellationReason.allPrematureCancellationReasons()}"
									var="reason" itemLabel="#{reason.reason}" itemValue="#{reason}" />

							</b:selectOneMenu>
							<b:message id="prematureCancellationReasonReasonMessage"
								for="inpPrematureCancellationReason" />
						</div>
						<b:commandButton value="Confirmer" class="get-started-btn"
							style="position: relative; top: 27px;"
							action="#{mbService.cancelServicePrematurely()}" />
					</b:form>
				</div>
			</div>
			<div class="modal-footer d-flex justify-content-center">
				<div class="signup-section">

					<h4></h4>
				</div>
			</div>

			<f:facet name="footer">
				<b:button id="closePrematureCancelModal" value="Fermer"
					dismiss="modal" />
			</f:facet>
		</b:modal> <p:dialog header="N° #{mbAnomaly.anomaly.anomalyNumber}"
			widgetVar="dlg1" height="300px" width="700px" modal="true"
			id="idAnomaly">

			<div class="dialog-element">
				<b:inputText value="#{mbAnomaly.anomaly.anomalyType.type}"
					disabled="true" />
			</div>
			<div class="dialog-element">
				<p:inputTextarea value="#{mbAnomaly.anomaly.description}"
					maxlength="255" rows="6" cols="100" disabled="true">
				</p:inputTextarea>
			</div>
			<ui:fragment
				rendered="#{mbAnomaly.anomaly.declarer ne mbUser.user and mbAnomaly.anomaly.endDate eq null}">

				<b:form>
					<div class="dialog-element">
						<b:commandButton class="get-started-btn"
							action="#{mbAnomaly.closeAnomaly(mbService.service)}"
							value="Régler" />
					</div>
				</b:form>
			</ui:fragment>
		</p:dialog> </main>


	</ui:define>

</ui:composition>

</html>