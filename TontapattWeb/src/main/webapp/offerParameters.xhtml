<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:b="http://bootsfaces.net/ui">

<ui:composition template="WEB-INF/template/userOffersTemplate.xhtml">



	<ui:define name="head">
		<title>Mes offres</title>
		<link rel="icon" href="resources/img/favicon.ico" />
	</ui:define>

	<ui:define name="content">
		<div class="title-page">
			<div class="section-title">
				<h2>Mes offres</h2>
				<p>Gérer mes offres</p>
			</div>
		</div>
		<div class="nav-box-offer">
			<div class="d-flex align-items-start">

				<div class="scroller">
					<div class="box-all-offer-user">
						<div class="nav flex-column nav-pills me-3" id="v-pills-tab"
							role="tablist" aria-orientation="vertical">

							<button class="nav-link active" id="v-pills-map-tab"
								data-bs-toggle="pill" data-bs-target="#v-pills-map"
								type="button" role="tab" aria-controls="v-pills-map"
								aria-selected="true">

								<div class="box-parameters">
									<div class="carousel-box">
										<b:carousel class="carousel">
											<b:carouselItem>
												<div class="reglage-picture-param">
													<b:image value="resources/img/carte.jpg" />
												</div>
											</b:carouselItem>
										</b:carousel>
									</div>

									<div class="wrap-image">

										<div class="description-box">
											<div class="title-zone">
												<div class="icon-parameters-box">
													<b:iconAwesome name="globe" size="lg" />
												</div>
												<h1>Carte</h1>
											</div>

											<div class="field-description">
												<p>Toutes mes offres</p>
											</div>
										</div>

									</div>

								</div>
								<hr />
							</button>

							<c:forEach items="#{mbShearingOffer.connectedUserOffers}"
								var="offer">

								<button class="nav-link" id="v-pills-box#{offer.id}-tab"
									data-bs-toggle="pill" data-bs-target="#v-pills-box#{offer.id}"
									type="button" role="tab" aria-controls="v-pills-box#{offer.id}"
									aria-selected="true">

									<div class="box-parameters">
										<div class="carousel-box">
											<b:carousel class="carousel">
												<c:forEach items="#{offer.photos}" var="photo">
													<b:carouselItem>
														<div class="reglage-picture-param">
															<b:image value="resources/img/offers/#{photo.link}" />
														</div>
													</b:carouselItem>
												</c:forEach>
											</b:carousel>
										</div>

										<div class="wrap-image">

											<div class="description-box">
												<div class="title-zone">
													<div class="icon-parameters-box">
														<b:iconAwesome name="map-marker" size="lg" />
													</div>
													<h1>#{offer.name}</h1>
												</div>
												<div
													class="d-flex justify-content-between align-items-center mb-3">
													<h4>#{offer.zipCodeCity.name}</h4>
												</div>
												<div class="field-description">
													<p>#{offer.description.subSequence(0,10)}...</p>
												</div>
											</div>


											<br />

										</div>

									</div>

									<hr />


								</button>

							</c:forEach>
						</div>
					</div>
				</div>
				<div class="tab-content" id="v-pills-tabContent">

					<div class="tab-pane fade show active" id="v-pills-map"
						role="tabpanel" aria-labelledby="v-pills-map-tab">
						<div id="map-box-offer"></div>
					</div>

					<c:forEach items="#{mbShearingOffer.connectedUserOffers}"
						var="offer">
						<div class="tab-pane fade" id="v-pills-box#{offer.id}"
							role="tabpanel" aria-labelledby="v-pills-box#{offer.id}-tab">

							<div class="box-presentation-offer">
								<div class="title-presentation-offer">
									<h1>#{offer.name}</h1>
								</div>

								<div class="box-colonne-offer">
									<div class="two-element-offer">
										<div class="one-element-offer">
											<h3>#{offer.race.species.species}</h3>
										</div>
										<div class="one-element-offer">
											<h3>#{offer.race.race}</h3>
										</div>
									</div>
									<div class="two-element-offer">
										<div class="one-element-offer">
											<h3>#{offer.animalCount} animaux</h3>
										</div>
										<div class="one-element-offer">
											<h3>#{offer.animalDailyPrice} €/jour</h3>
										</div>
									</div>
									<div class="two-element-offer">
										<div class="one-element-offer">
											<h3>Du #{offer.startDate}</h3>
										</div>
										<div class="one-element-offer">
											<h3>Au #{offer.endDate}</h3>
										</div>
									</div>
									<div class="two-element-offer">
										<div class="one-element-offer">
											<h3>À #{offer.zipCodeCity.name}</h3>
										</div>
										<div class="one-element-offer">
											<h3>Jusqu'à #{offer.maxTravelDist} Km</h3>
										</div>
									</div>

									<p:commandButton action="#{mbShearingOffer.offerDetails()}"
										styleClass="rounded-button ui-button-success" value="Modifier">
										<f:setPropertyActionListener value="#{offer}"
											target="#{mbShearingOffer.shearingOffer}" />
									</p:commandButton>
								</div>
							</div>
						</div>
					</c:forEach>
				</div>
			</div>
		</div>

		<script>
				var offerMap = L.map('map-box-offer').setView([46.2276, 2.2137], 6);
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiaGFqam91anRpIiwiYSI6ImNrc2MzNTRvczBjc2YydnFrZHRwdzZmc20ifQ.Z4qyHk4NtUctoB_uDmjHPA', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'your.mapbox.access.token'
        }).addTo(offerMap);
		
		var breederIcon = L.icon({
    		iconUrl: 'resources/img/breeder.png',

    		iconSize:     [48, 55], // size of the icon
    		shadowSize:   [50, 64], // size of the shadow
    		iconAnchor:   [22, 55], // point of the icon which will correspond to marker's location
    		popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
		});
        
        var offers = #{mbShearingOffer.connectedUserOffersAsJson()}
        console.log(offers);
        for (var i = 0; i &lt; offers.length; i++) {
    		var offer = offers[i];
    		var marker = L.marker([offer.zipCodeCity.latitude, offer.zipCodeCity.longitude], {icon: breederIcon})
    		.addTo(offerMap).bindPopup("<b>"+offer.name+"</b><p>"+offer.zipCodeCity.name+", FR</p>");

		}
	</script>

	</ui:define>

</ui:composition>

</html>